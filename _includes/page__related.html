{% assign posts = include.posts | where_exp: "post", "post.hidden != true" %}
<div class="page__related">
  {% include before-related.html %}
  <h2 class="page__related-title">{{ site.data.ui-text[site.locale].related_label | default: "You May Also Enjoy" }}</h2>
  <div class="grid__wrapper" id="posts-container"><!--aÃ±adido id para ejecutarlo en script -->
    {% assign count = 0 %} <!-- Inicializar contador -->

    {% for post in posts %} <!-- reversed order if javascript disabled -->
      {% if post.id == page.id %}{% continue %}{% endif %}
      {% if count < 6 %} <!-- Mostrar solo las primeras 4 publicaciones -->

        {% include archive-single.html type="grid" %}
        {% assign count = count | plus: 1 %} <!-- Incrementar contador -->
      {% endif %}

    {% endfor %}
  </div>
  <div><b><a href="../../posts/" rel="nofollow">More...</a></b></div>

    <!-- Script para mezclar posts aleatoriamente -->
    <script>
      // Mezcla los posts aleatoriamente
      const container = document.getElementById('posts-container');
      if (container) {
        const posts = Array.from(container.children);
        posts.sort(() => Math.random() - 0.5); // Mezcla aleatoriamente
        posts.forEach(post => container.appendChild(post)); // Vuelve a agregar los posts en orden aleatorio
      }
    </script>

</div>